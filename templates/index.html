<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radar Jemily | Profesional</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>

<div class="container">
    <div class="language-picker">
        <button onclick="cambiarIdioma('es')">ðŸ‡²ðŸ‡½ ES</button>
        <button onclick="cambiarIdioma('en')">ðŸ‡ºðŸ‡¸ EN</button>
    </div>

    <h1 id="txt-title" class="main-title">ðŸ“¡ Radar Jemily</h1>
    <p id="txt-subtitle" class="subtitle">Explora el mundo con Jemily</p>

    <div class="search-section">
        <input type="text" id="cityInput" placeholder="Escribe una ciudad...">
        <button id="btn-city" onclick="buscarCiudad()">Explorar</button>
    </div>

    <div id="resultado" class="card hidden">
        <div class="header">
            <img id="flag" width="50">
            <h2 id="location"></h2>
            <div id="weatherInfo">
                <span id="tempMain"></span>
                <p id="weatherDesc"></p>
            </div>
        </div>
        <div id="map"></div>
        <div class="grid" id="dataGrid"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
let map;
const traducciones = {
    'es': { 
        'title': 'ðŸ“¡ Radar Jemily', 
        'subtitle': 'Explora el mundo con Jeremy & Emily', 
        'btnCity': 'Explorar', 
        'label': {
            'region': 'ðŸŒŽ RegiÃ³n', 'population': 'ðŸ‘¥ PoblaciÃ³n', 'currency': 'ðŸ’° Moneda', 
            'latitude': 'ðŸ“ Latitud', 'longitude': 'ðŸ“ Longitud', 'feels_like': 'ðŸŒ¡ï¸ SensaciÃ³n',
            'humidity': 'ðŸ’§ Humedad', 'pressure': 'ðŸ“‰ PresiÃ³n', 'wind_speed': 'ðŸŒ¬ï¸ Viento',
            'clouds': 'â˜ï¸ Nubes', 'visibility': 'ðŸ‘ï¸ Visibilidad', 'temp_max': 'ðŸ“ˆ MÃ¡xima',
            'temp_min': 'ðŸ“‰ MÃ­nima', 'sunrise': 'ðŸŒ… Amanecer', 'sunset': 'ðŸŒ‡ Atardecer'
        } 
    },
    'en': { 
        'title': 'ðŸ“¡ Radar Jemily', 
        'subtitle': 'Explore the world with Jeremy & Emily', 
        'btnCity': 'Explore', 
        'label': {
            'region': 'ðŸŒŽ Region', 'population': 'ðŸ‘¥ Population', 'currency': 'ðŸ’° Currency', 
            'latitude': 'ðŸ“ Latitude', 'longitude': 'ðŸ“ Longitude', 'feels_like': 'ðŸŒ¡ï¸ Feels Like',
            'humidity': 'ðŸ’§ Humidity', 'pressure': 'ðŸ“‰ Pressure', 'wind_speed': 'ðŸŒ¬ï¸ Wind',
            'clouds': 'â˜ï¸ Clouds', 'visibility': 'ðŸ‘ï¸ Visibility', 'temp_max': 'ðŸ“ˆ Max Temp',
            'temp_min': 'ðŸ“‰ Min Temp', 'sunrise': 'ðŸŒ… Sunrise', 'sunset': 'ðŸŒ‡ Sunset'
        } 
    }
};

function cambiarIdioma(lang) {
    localStorage.setItem("idioma", lang);
    const t = traducciones[lang];
    document.getElementById('txt-title').innerText = t.title;
    document.getElementById('txt-subtitle').innerText = t.subtitle;
    document.getElementById('btn-city').innerText = t.btnCity;
    document.getElementById('cityInput').placeholder = lang === 'es' ? 'Escribe una ciudad...' : 'Type a city...';
}

async function buscarCiudad() {
    const ciudad = document.getElementById("cityInput").value;
    if(!ciudad) return;
    const res = await fetch(`/city/${ciudad}`);
    const data = await res.json();
    if(data.detail) return alert("Ciudad no encontrada");
    mostrarResultado(data);
}

function mostrarResultado(data) {
    const lang = localStorage.getItem("idioma") || 'es';
    document.getElementById("resultado").classList.remove("hidden");

    // Fondo DinÃ¡mico Unsplash (Eliminamos lÃ³gica de audio)
    const query = `${data.city} landscape`;
    document.body.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://source.unsplash.com/1600x900/?${query}')`;

    document.getElementById("flag").src = data.flag;
    document.getElementById("location").innerText = `${data.city}, ${data.country}`;
    document.getElementById("tempMain").innerText = `${data.temperature}Â°C`;
    document.getElementById("weatherDesc").innerText = data.weather_desc;

    // Mapa
    if (map) map.remove();
    map = L.map('map').setView([data.latitude, data.longitude], 11);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);
    L.marker([data.latitude, data.longitude]).addTo(map).bindPopup(data.city).openPopup();

    // Grid de datos
    const grid = document.getElementById("dataGrid");
    grid.innerHTML = "";
    
    // Lista de claves a mostrar (10 datos climÃ¡ticos + poblaciÃ³n, regiÃ³n, etc)
    const items = [
        'region', 'population', 'currency', 'latitude', 'longitude',
        'feels_like', 'humidity', 'wind_speed', 'pressure', 'clouds', 
        'visibility', 'temp_max', 'temp_min', 'sunrise', 'sunset'
    ];
    
    items.forEach(key => {
        let val = data[key];
        const label = traducciones[lang].label[key];
        
        if (key === 'population') val = Number(val).toLocaleString(lang === 'es' ? 'es-ES' : 'en-US');
        if (key === 'visibility') val += " km";
        if (key === 'humidity' || key === 'clouds') val += "%";
        if (key === 'feels_like' || key === 'temp_max' || key === 'temp_min') val += "Â°C";
        if (key === 'wind_speed') val += " m/s";
        if (key === 'pressure') val += " hPa";

        grid.innerHTML += `<div class="item"><strong>${label}</strong><br>${val}</div>`;
    });
}
</script>
</body>
</html>