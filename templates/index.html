<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radar Jemily | 4D Experience</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>

<div class="container">
    <div class="language-picker">
        <button onclick="cambiarIdioma('es')">拆 ES</button>
        <button onclick="cambiarIdioma('en')">吼 EN</button>
    </div>

    <h1 id="txt-title" class="main-title"> Radar Jemily</h1>
    <p id="txt-subtitle" class="subtitle">Explora el mundo con Jemily</p>

    <div class="search-section">
        <input type="text" id="cityInput" placeholder="Escribe una ciudad...">
        <button id="btn-city" onclick="buscarCiudad()">Explorar</button>
    </div>

    <div id="resultado" class="card hidden">
        <div class="header">
            <img id="flag" width="50">
            <h2 id="location"></h2>
            <div id="weatherInfo">
                <span id="tempMain"></span>
                <p id="weatherDesc"></p>
            </div>
        </div>
        <div id="map"></div>
        <div class="grid" id="dataGrid"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
let map;
const traducciones = {
    'es': { 'title': ' Radar Jemily', 'subtitle': 'Explora el mundo con Jeremy & Emily', 'btnCity': 'Explorar', 'label': {'humidity': 'Humedad', 'feels_like': 'Sensaci贸n', 'region': 'Regi贸n', 'population': 'Poblaci贸n', 'currency': 'Moneda', 'latitude': 'Latitud', 'longitude': 'Longitud'} },
    'en': { 'title': ' Radar Jemily', 'subtitle': 'Explore the world with Jeremy & Emily', 'btnCity': 'Explore', 'label': {'humidity': 'Humidity', 'feels_like': 'Feels Like', 'region': 'Region', 'population': 'Population', 'currency': 'Currency', 'latitude': 'Latitude', 'longitude': 'Longitude'} }
};

function cambiarIdioma(lang) {
    localStorage.setItem("idioma", lang);
    const t = traducciones[lang];
    document.getElementById('txt-title').innerText = t.title;
    document.getElementById('txt-subtitle').innerText = t.subtitle;
    document.getElementById('btn-city').innerText = t.btnCity;
    document.getElementById('cityInput').placeholder = lang === 'es' ? 'Escribe una ciudad...' : 'Type a city...';
}

async function buscarCiudad() {
    const ciudad = document.getElementById("cityInput").value;
    if(!ciudad) return;
    const res = await fetch(`/city/${ciudad}`);
    const data = await res.json();
    if(data.detail) return alert("Ciudad no encontrada");
    mostrarResultado(data);
}

function mostrarResultado(data) {
    const lang = localStorage.getItem("idioma") || 'es';
    document.getElementById("resultado").classList.remove("hidden");

    // Fondo Din谩mico Unsplash
    const query = `${data.city} landscape`;
    document.body.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://source.unsplash.com/1600x900/?${query}')`;

    document.getElementById("flag").src = data.flag;
    document.getElementById("location").innerText = `${data.city}, ${data.country}`;
    document.getElementById("tempMain").innerText = `${data.temperature}掳C`;
    document.getElementById("weatherDesc").innerText = data.weather_desc;

    // Mapa
    if (map) map.remove();
    map = L.map('map').setView([data.latitude, data.longitude], 11);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);
    L.marker([data.latitude, data.longitude]).addTo(map).bindPopup(data.city).openPopup();

    // Grid de datos con comas en poblaci贸n
    const grid = document.getElementById("dataGrid");
    grid.innerHTML = "";
    const items = ['region', 'population', 'currency', 'humidity', 'feels_like', 'latitude', 'longitude'];
    
    items.forEach(key => {
        let val = data[key];
        if (key === 'population') val = Number(val).toLocaleString(lang === 'es' ? 'es-ES' : 'en-US');
        if (key === 'latitude' || key === 'longitude') val = Number(val).toFixed(2);
        grid.innerHTML += `<div class="item"><strong>${traducciones[lang].label[key]}</strong><br>${val}</div>`;
    });
}
</script>
</body>
</html>